# リトライ間隔

リクエストに失敗してリトライするとき、どれくらい間隔を空けるかはいくつかの方法がある。

## バックオフなし

同じ間隔でリトライする方法。クライアント数が増えるにつれて全リクエストが完了するまでにかかる時間は線形に増加し、全体のリクエスト数は指数関数的に増える。


## エクスポネンシャルバックオフ

失敗するたびにリトライの間隔を倍にしていく方法。たとえば、1秒→2秒→4秒→8秒→...としていく。  
リトライ数が増えるにつれて間隔が長くなりすぎるので、一般的には上限を設けてそれ以上リトライしないようにする。  
バックオフなしより全体のリクエスト数などがわずかに改善されるが、効果は大きくない。  
これはリクエストが同じタイミングに集中したとき、同じ間隔でリトライされるので、結局タイミングがかぶるため。


## エクスポネンシャルバックオフアンドジッター

エクスポネンシャルバックオフと同様に計算した値を最大値としてランダムな間隔でリトライする方法。たとえば、(0, 1]秒→(0-2]秒→(0-4]秒→(0-8]秒→...としていく。  
複数のクライアントのリトライ間隔がかぶる問題を解消できる。  
全体のリクエスト数が他の方法よりかなり改善される。


## 参考

- [Exponential Backoff And Jitter | AWS Architecture Blog](https://aws.amazon.com/jp/blogs/architecture/exponential-backoff-and-jitter/)
- [クラウド・ネイティブのお作法（2）「リトライ」～効率的なリトライ手法「Exponential Backoff and jitter」とは何か (1/3)|CodeZine（コードジン）](https://codezine.jp/article/detail/10739)
    - 上のAWSの記事を日本語で解説した記事
