# resetのオプションによる違い

`git reset <option> target` の `<option>` によって各ファイルごとにどの状態になるか変わる。  
以下は共通。

- 追跡していないファイルは保持される
- HEADは常にtargetの状態になる

## `--soft`

ワークツリーもインデックスも元の状態を保持する。  
間違えてコミットして、ステージング状態も含めて戻したいときに使う。

| 変更前のワークツリー | 変更前のインデックス | HEAD | target | 概要                                   | 変更後のワークツリー | 変更後のインデックス |
|----------------------|----------------------|------|--------|----------------------------------------|----------------------|----------------------|
| A                    | B                    | C    | D      | コミット間に差分があり、変更があるとき | A                    | B                    |
| A                    | A                    | A    | B      | コミット間に差分があり、変更がないとき | A                    | A                    |
| A                    | B                    | C    | C      | コミット間に差分がなく、変更があるとき | A                    | B                    |
| A                    | A                    | A    | A      | コミット間に差分がなく、変更がないとき | A                    | A                    |


## `--mixed`

ワークツリーは保持し、インデックスは破棄してtargetの状態にする。  
オプションを何も指定しないとこのオプションと同じになる。  
間違えてコミットして、ステージング状態を破棄したいときに使う。

| 変更前のワークツリー | 変更前のインデックス | HEAD | target | 概要                                   | 変更後のワークツリー | 変更後のインデックス |
|----------------------|----------------------|------|--------|----------------------------------------|----------------------|----------------------|
| A                    | B                    | C    | D      | コミット間に差分があり、変更があるとき | A                    | D                    |
| A                    | A                    | A    | B      | コミット間に差分があり、変更がないとき | A                    | B                    |
| A                    | B                    | C    | C      | コミット間に差分がなく、変更があるとき | A                    | C                    |
| A                    | A                    | A    | A      | コミット間に差分がなく、変更がないとき | A                    | A                    |


## `--hard`

ワークツリーもインデックスも破棄してtargetの状態にする。  
変更をすべて破棄して特定のコミットに戻したいときに使う。  
コミットされていない変更も破棄されて戻せないので注意。

| 変更前のワークツリー | 変更前のインデックス | HEAD | target | 概要                                   | 変更後のワークツリー | 変更後のインデックス |
|----------------------|----------------------|------|--------|----------------------------------------|----------------------|----------------------|
| A                    | B                    | C    | D      | コミット間に差分があり、変更があるとき | D                    | D                    |
| A                    | A                    | A    | B      | コミット間に差分があり、変更がないとき | B                    | B                    |
| A                    | B                    | C    | C      | コミット間に差分がなく、変更があるとき | C                    | C                    |
| A                    | A                    | A    | A      | コミット間に差分がなく、変更がないとき | A                    | A                    |


## `--keep`

コミット間に差分があり、変更があるときはエラーになる。  
コミット間に差分があり、変更がないときはワークツリーもインデックスもtargetの状態にする。（`--hard` 相当）  
コミット間に差分がないときは、ワークツリーは保持し、インデックスは破棄してtargetの状態にする。（`--mixed` 相当）  
特定のファイルの変更を含むコミットに戻したいが、それ以外のコミットしていない変更は保持したいときに使う。  
たとえばドキュメントの変更中にソースコードの変更を含むコミットを戻したいときなど。  
このときに `--hard` を使うとドキュメントの変更が消えてしまい、`--mixed` を使うとワークツリーのソースコードが戻らない。

| 変更前のワークツリー | 変更前のインデックス | HEAD | target | 概要                                   | 変更後のワークツリー | 変更後のインデックス |
|----------------------|----------------------|------|--------|----------------------------------------|----------------------|----------------------|
| A                    | B                    | C    | D      | コミット間に差分があり、変更があるとき | エラー               | エラー               |
| A                    | A                    | A    | B      | コミット間に差分があり、変更がないとき | B                    | B                    |
| A                    | B                    | C    | C      | コミット間に差分がなく、変更があるとき | A                    | C                    |
| A                    | A                    | A    | A      | コミット間に差分がなく、変更がないとき | A                    | A                    |


## `--merge`

マージでコンフリクトしたときにマージ前の状態に戻すときに使うが、基本的に `git merge --abort` で良いのでここでは省略する。


## 参考

- [Git - git-reset Documentation](https://git-scm.com/docs/git-reset#_discussion)
