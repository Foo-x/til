# バッファ操作

vimで開いたファイルはバッファに保持される。  
バッファはウィンドウで表示される。  
ウィンドウをまとめたものをタブという。


## バッファの種類

- アクティブ
    - ウィンドウに表示されているバッファ
    - バッファリストで `a` の目印が付く
- 隠れ
    - ウィンドウには表示されていないがメモリにはロードされているバッファ
    - 主に変更が保存されずに非表示になったもの
    - バッファリストで `h` の目印が付く
- 非アクティブ
    - ウィンドウに表示されておらず、メモリにもロードされていないバッファ
    - バッファリストで目印が付かない


## ファイルをバッファに保持

- `vim {file1} {file2} ...`
    - {file1} のみ表示し、それ以外をバッファに保持
- `vim -o {file1} {file2} ...`
    - 水平に分割してすべてのファイルを表示
- `vim -O {file1} {file2} ...`
    - 垂直に分割してすべてのファイルを表示
- `vim -p {file1} {file2} ...`
    - ファイルをそれぞれタブに入れて {file1} のタブを表示
- `:e[dit] {file}`
    - 現在のウィンドウに {file} を表示
    - 開いていたファイルはバッファに保持される
- `:ene[w]`
    - 新しいバッファを開いて現在のウィンドウに表示
    - 開いていたファイルはバッファに保持される
- `:sp[lit] [file]`
    - 水平に分割した新しいウィンドウに [file] を表示
    - [file] を省略した場合は現在のバッファ
- `:vs[plit] [file]`
    - 垂直に分割した新しいウィンドウに [file] を表示
    - [file] を省略した場合は現在のバッファ
- `:new [file]`
    - 水平に分割した新しいウィンドウに [file] を表示
    - [file] を省略した場合は空のバッファ
- `:vne[w] [file]`
    - 垂直に分割した新しいウィンドウに [file] を表示
    - [file] を省略した場合は空のバッファ
- `:bad[d] {file}`
    - {file} をバッファリストに追加
- `gf`
    - 現在のウィンドウにカーソル位置のファイルを表示
- `gF`
    - `gf` と同様だが、ファイル名の後ろに番号がある場合はその行に移動
    - ファイル名と番号はファイル名以外の文字かつ数字以外の文字で区切られる
        - ファイル名の文字はオプションの `isfname` で設定される
- `CTRL-W f`, `CTRL-W CTRL-f`
    - `gf` と同様だが、水平に分割した新しいウィンドウに表示
- `CTRL-W F`
    - `gF` と同様だが、水平に分割した新しいウィンドウに表示
- `CTRL-W gf`
    - `gf` と同様だが、新しいタブに表示
- `CTRL-W gF`
    - `gF` と同様だが、新しいタブに表示


## バッファをウィンドウに表示

- `:ls[!]`
    - バッファリストを表示
    - `!` を付けるとリストされていないバッファも表示する
        - quickfix、help、unlistedなど
- `:[N]b[uffer][!] [buffer]`
    - [buffer] を表示
    - [buffer] はバッファのインデックスかバッファ名
    - `!` を付けると `hidden` オプションがオフであっても編集中のバッファを隠れバッファにする
    - [buffer] を省略した場合は何もしない（現在のバッファをそのまま表示）
- `:[N]bn[ext][!] [N]`
    - バッファリストの [N] 個先のバッファを表示
    - `!` を付けると `hidden` オプションがオフであっても編集中のバッファを隠れバッファにする
    - [N] を省略した場合は1
- `:[N]sbn[ext] [N]`
    - 水平に分割した新しいウィンドウにバッファリストの [N] 個先のバッファを表示
    - [N] を省略した場合は1
- `:[N]bp[revious][!] [N]`
    - バッファリストの [N] 個前のバッファを表示
    - `!` を付けると `hidden` オプションがオフであっても編集中のバッファを隠れバッファにする
    - [N] を省略した場合は1
- `:[N]sbp[revious][!] [N]`
    - 水平に分割した新しいウィンドウにバッファリストの [N] 個前のバッファを表示
    - [N] を省略した場合は1
- `:[N]sb[uffer] [buffer]`
    - 水平に分割した新しいウィンドウに [buffer] を表示
    - [buffer] はバッファのインデックスかバッファ名
    - [buffer] を省略した場合は現在のバッファ
- `:[N]unh[ide] [N]`
    - バッファリストの [N] 個分のアクティブもしくは隠れ状態のバッファごとにウィンドウを表示する
    - [N] を省略した場合はすべてのアクティブもしくは隠れ状態のバッファ
- `:[N]ba[ll] [N]`
    - バッファリストの [N] 個分のバッファごとにウィンドウを表示する
    - [N] を省略した場合はすべてのバッファ


## バッファ削除

- `:[N]bd[lete][!] [buffer]`
    - [buffer] またはバッファ [N] を非アクティブにしてバッファリストから削除
    - バッファが編集中の場合は失敗する
        - `!` を付けると失敗せずに変更が破棄される
    - バッファは完全には削除されず、`:ls!` でunlistedとして表示される
    - [buffer] や [N] を省略した場合は現在のバッファ
- `:N,Mbd[lete][!]`
    - N番目からM番目のバッファを非アクティブにしてバッファリストから削除
    - バッファが編集中の場合は失敗する
        - `!` を付けると失敗せずに変更が破棄される
    - バッファは完全には削除されず、`:ls!` でunlistedとして表示される
- `:[N]bw[ipeout][!] [buffer]`
    - `:bd[lete][!] [buffer]` と同様だが、バッファを完全に削除する
        - `:ls!` でも表示されない
- `:N,Mbw[ipeout][!]`
    - `:N,Mbd[lete][!]` と同様だが、バッファを完全に削除する
        - `:ls!` でも表示されない
- `:[N]bun[load][!] [buffer]`
    - [buffer] またはバッファ [N] を非アクティブにする
        - バッファリストには残る
    - バッファが編集中の場合は失敗する
        - `!` を付けると失敗せずに変更が破棄される
    - [buffer] や [N] を省略した場合は現在のバッファ


## ウィンドウ削除

- `:[count]q[uit][!]`
    - [count] のウィンドウを削除
    - 最後のウィンドウを閉じた場合はvimが終了する
    - `hidden` オプションがオンのとき、カレントバッファを表示しているウィンドウが他になければ隠れバッファになる
    - `hidden` オプションがオフのとき、カレントバッファを表示しているウィンドウが他になくて編集中であれば失敗する
        - `!` を付けると失敗せずに変更が破棄される
    - [count] を省略した場合はカレントウィンドウ
- `:[count]clo[se][!]`
    - [count] のウィンドウを削除
    - 最後のウィンドウは削除できない
    - `hidden` オプションがオンか、カレントバッファを表示しているウィンドウが他にない状態で `!` を付けたときは隠れバッファになる
    - `hidden` オプションがオフで、カレントバッファを表示しているウィンドウが他になくて編集中かつ `!` を付けていなければ失敗する
    - `!` を付けたとしても変更が失われることはないため、安全なコマンド
    - [count] を省略した場合はカレントウィンドウ
- `:[count]hid[e]`
    - [count] のウィンドウを削除
    - 最後のウィンドウは削除できない
    - `bufhidden` が `unload`、`delete`、`wipe` のいずれでもなく、カレントバッファを表示しているウィンドウが他になければ隠れバッファになる
        - `bufhidden` が設定されているときはその設定に従う
    - `bufhidden` が設定されていないときは変更が失われることはないため、安全なコマンド
    - [count] を省略した場合はカレントウィンドウ
- `:[count]on[ly][!]`
    - [count] のウィンドウ以外のウィンドウを閉じる
    - `hidden` オプションがオンのときは、閉じられたウィンドウは隠れバッファになる
    - `hidden` オプションがオフのときは、編集中のバッファは閉じられない
        - `!` を付けた場合は隠れバッファになる
    - [count] を省略した場合はカレントウィンドウ


## その他

- `:vert[ical] {cmd}`
    - 水平分割でファイルを開く {cmd} を垂直分割で実行
    - 水平分割のコマンドしか用意されていないものに使う
    - たとえば `:vert sb buffer` とすると垂直分割でバッファを開く
- `:qa[ll][!]`
    - vimを終了する
    - 複数のウィンドウを開いていて、すぐにvimを終了したいときに便利
    - また、複数のウィンドウを開いた状態で VimLeave のautocmdを動作させたいときなどにも便利
    - 編集中のバッファがあるときは失敗する
        - `!` を付けた場合は編集を破棄して強制終了する
