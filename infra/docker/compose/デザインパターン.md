# デザインパターン

## サイドカーパターン

メインのコンテナとは別にボリュームを共有するサイドカーコンテナを用意する。  
サイドカーコンテナはメインコンテナが出力したデータを外部にpushしたり、外部からデータをpullしてメインコンテナで使えるようにしたりする。

メリットは以下の通り。

- 計算リソースをメインコンテナに優先して割り当てて、サイドカーコンテナはリソースが余っているときに処理を行うことでメインコンテナの負荷が下がる
- それぞれの処理を別々に開発できるのでチームを分けたり独立してテストしやすくなったりする
- サイドカーコンテナを他のメインコンテナに再利用できる


## アンバサダーパターン

メインのコンテナが外部にアクセスする際にプロキシとして動作するアンバサダーコンテナを用意する。  
アンバサダーコンテナは外部のアクセス先のエンドポイントを管理する。  
サイドカーパターンの一種とすることもある。

メリットは以下の通り。

- 外部のエンドポイントが変わったとき、アンバサダーコンテナの設定を変更するだけで済む
    - メインコンテナは常にアンバサダーコンテナを見ているので変更不要
- DBのシャーディングなどで複数のエンドポイントにアクセスする必要があっても、メインコンテナはアンバサダーコンテナにアクセスするだけで済む


## アダプターパターン

外部からのアクセスに対して共通のインタフェースを提供するアダプターコンテナを用意する。

メリットは以下の通り。

- 外部に公開するインタフェースが決まっていて、メインコンテナがそれに対応できないときにアダプターコンテナで吸収できる
    - レガシーなアプリを対応させるときなど


## 参考

- [コンテナ・デザイン・パターンの論文要約　 #Docker - Qiita](https://qiita.com/MahoTakara/items/03fc0afe29379026c1f3)
- [Design patterns for container-based distributed systems](https://www.usenix.org/system/files/conference/hotcloud16/hotcloud16_burns.pdf)
