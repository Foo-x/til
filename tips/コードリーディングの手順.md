# コードリーディングの手順

1. 目的を決める
    - 例
        - 特定の機能について理解する
        - 全体の構造を把握する
        - ある値の流れを調査する
        - バグを調査する
2. ドキュメントを読む
    - 『Code Reading』によるとドキュメントを1分読むのはコードを1時間読むのに相当する
    - 主要な機能とそのフロー（シーケンス）が分かると読み進めやすくなる
        - フローチャート
        - シーケンス図
        - データフロー図
        - 画面遷移図、UI Flows
        - 状態遷移図
    - 主要なデータとその流れやデータ間の関係が分かると読み進めやすくなる
        - ER図
        - データフロー図
    - モジュール間の依存関係が分かると読み進めやすくなる
        - クラス図
        - 依存関係グラフ
    - 最終更新日に注意
        - 実装と乖離している場合があるため
3. タスク管理ツール、過去のプルリクエスト、Gitのログなどを見て、どういう変更がされたか確認する
    - 特に最近変更された箇所は頻繁に変更されている可能性が高く、コアの部分である可能性も高い
    - 特定のファイルに着目している場合は git blame も有効
4. ディレクトリ構成を確認する
    - Clean Architecture やMVCなど有名なアーキテクチャに沿っていたり、フレームワークが定めている構造に従っていたりすることが分かると読み進めやすくなる
5. 決めた目的に応じた箇所から読み始める
    - エラーが発生した箇所やエントリーポイントなど
    - **フォーカルポイント** という
6. ドキュメンテーションコメントを読む
    - 書かれていなかったり、適当なプロジェクトだと無理
7. コードを読む


## テクニック

### 汎用

- 図を書いてみる
    - フローチャート
    - シーケンス図
    - データフロー図
    - 画面遷移図、UI Flows
    - 状態遷移図
    - クラス図
    - 依存関係グラフ
    - 自動生成ツールが使えるときは活用する
    - 時間をかけすぎると本末転倒なので、ざっくりと
- どのようなデータがあるか把握する
    - データ間の関係も重要
        - 多重度や依存関係など
    - データの流れも重要
        - どのようなときに生成されるか
        - どのようなときに何に変換されるか
        - どのようなときに使用されるか
    - ER図やデータフロー図がある場合はそれを読む
- 実際にプログラムを動かしてみる
- デザインパターンに当てはめられるかという視点で読む
    - 当てはめられる場合、そのパターンの構成要素があることを予想できたり、要素間の関係をすぐに把握できる
- ただ読むのではなくメモしながら読む
    - どこまで把握したのかを整理して、同じところを何度も読むのを防ぐため
    - わかったこと、まだわかっていないことを列挙しておく
    - 図も含めると把握したところがわかりやすくなるだけでなく、把握していない箇所も図の中で空白になることによって気づきやすくなる


### ディレクトリ

- ディレクトリ間の依存関係を把握する
    - あるディレクトリ内のあるファイルが別のディレクトリ内のファイルに依存している場合、それ以外のファイルも同じ方向に依存している可能性が高い
        - 設計が悪い場合、循環しているケースもあるので注意
    - Clean Architecture やMVCなど有名なアーキテクチャに沿っていたり、フレームワークが定めている構造に従っていたりすることが分かると読み進めやすくなる


### ファイル

- ファイルの構成を把握する
    - 宣言だけ見る（クラス、メソッド、定数、変数など）
    - 宣言の並び順に規則がある場合はコードリーディングのヒントになる
        - 例
            - 常に下に宣言されている関数から上に宣言されている関数のみ呼び出している
            - 辞書順で宣言されている
- すべての括弧を折りたたんで、読み進めながら展開する
    - VSCodeならコマンドパレットから `fold all`


### 関数

- 処理の中で重要なところだけ読む
    - その関数で最終的に何をしているのか
        - 返している値
        - 副作用(void関数の呼び出し)
    - 特定の値に着目している場合はその値に関係ないところを読み飛ばす
- 分岐を枝刈りしながら読む
    - 1つのパターンずつ見て、それ以外は無視
    - 特に、特定のフローに着目している場合はそれ以外を読み飛ばす
- 特殊なデータ構造を使っていないか注意する
    - 可変長配列や連想配列は特にコードリーディングのヒントにならないが、キュー・スタック・集合などはそれを使う理由があったということなので、ヒントになる
